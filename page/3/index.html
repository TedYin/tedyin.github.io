<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>TedYin&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Half full stack developer.">
<meta property="og:type" content="website">
<meta property="og:title" content="TedYin's Blog">
<meta property="og:url" content="http://www.tedyin.me/page/3/index.html">
<meta property="og:site_name" content="TedYin's Blog">
<meta property="og:description" content="Half full stack developer.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TedYin's Blog">
<meta name="twitter:description" content="Half full stack developer.">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xii1s.com1.z0.glb.clouddn.com/me.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">TedYin</a></h1>
		</hgroup>

		
		<p class="header-subtitle">快乐比生命更重要！</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>A propos</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/TedYin" title="github">github</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">Half full stack developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">TedYin</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://7xii1s.com1.z0.glb.clouddn.com/me.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">TedYin</h1>
			</hgroup>
			
			<p class="header-subtitle">快乐比生命更重要！</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/TedYin" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-mysql-add-foreignkey" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/08/31/mysql-add-foreignkey/" class="article-date">
  	<time datetime="2014-08-31T03:19:20.000Z" itemprop="datePublished">2014-08-31</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/31/mysql-add-foreignkey/">MySQL添加外键</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##什么是外键<br>外键（Foreign Key），是SQL中的一种约束。假设有一个表A，外键约束的是它和别的表之间的参照关系，假如A表中的某个字段（或者某几个字段）是别的表中的数据，如果别的表没有这个数据A中的相应字段也不能有这些数据，那么A表中的这几个字段和别的表中的这几个字段就存在某种约束，这种约束就称为外键。</p>
<p>##添加外键的步骤<br>假设有A、B两个表，A中的aid的取值必须在B中的bid的某个值，即aid references bid</p>
<p>###1. 需要在参考字段(aid)和被参考字段(bid)，之间建立索引<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table A add index IDX_aid (aid); ——为A的aid字段添加索引</span><br><span class="line">alter table B add index IDX_bid (bid); ——为B的bid字段添加索引</span><br></pre></td></tr></table></figure></p>
<p>###2. 建立好索引之后，为A表添加到B表的外键约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">—— 添加约束</span><br><span class="line">alter table A add constraint FK_aid_bid</span><br><span class="line">foreign key (aid)</span><br><span class="line">references B.bid;</span><br></pre></td></tr></table></figure>
<p>这样就建立好了aid到bid的外键，aid的值只能是bid的值中某个，不可能是别的</p>
<p>##级联操作<br>上述约束建立好了，如果bid发生了变化，我么也希望aid跟着一起变化，那怎么办呢？这个“一起变化”的希望，实际上就是一个级联操作。可以通过<code>on update cascade</code>这句约束来实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">—— 添加约束</span><br><span class="line">alter table A add constraint FK_aid_bid</span><br><span class="line">foreign key (aid)</span><br><span class="line">references B(bid)</span><br><span class="line">on update cascade;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>加入<code>on update cascade</code>之后将会对aid进行同步更新。除<code>cascade</code>之外，我们还可以通过<code>restrict</code>来禁止在bid发生变化时也使得aid发生变更，我们还可以使用<code>set null</code>约束，来使得在bid发生变更后将相应的aid置为null。</p>
</li>
<li><p>除了可以监控update的操作外，我们还可以使用<code>on delete [cascade | ···]</code>作为条件判断，当发生上面的条件时，可以使用<code>cascade</code>、<code>restrict</code>、<code>set null</code>等对外键进行操作。</p>
</li>
</ul>
<p>##删除外键</p>
<p>###指定外键名称时删除外键<br>如果现在aid不需要再参考bid了，我们可以删除掉这个约束。<br>上面在定义外键的时候，给这个外键取了个名字<code>FK_aid_bid</code>，因此我们可以通过这个外键的名字来删除外键。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table A drop foreign key FK_aid_bid;</span><br></pre></td></tr></table></figure></p>
<p>这样就可以删除掉外键了，但是之前建立的索引不会被删除，如果要删除索引，需要自己手动删除。</p>
<p>###未指定外键名称时删除外键<br>如果在建立外键时并没有指定外键名称<em>eg: fk_symbol</em>，那怎么办？实际上如果没有指定外键名，MySql会默认加上这个外键名，获取这个默认外键名称的方法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create table tableName;</span><br></pre></td></tr></table></figure></p>
<p>即可查看到该表的详细创建信息，里面就有MySql默认生成的外键名称，拿到该名称就可以删除该外键了。</p>
<p>##遇到的问题<br>在创建外键的过程中我遇到无法创建的问题，解决办法：<br>为了得到详细的错误原因，可以使用下面方法来获取出错的详细信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW ENGINE INNODB STATUS\G</span><br></pre></td></tr></table></figure>
<p>###常见的错误原因：</p>
<ul>
<li>没有建立索引</li>
<li>外键(aid)和参考字段(bid)的值类型不一样</li>
<li>创建外键的SQL有误</li>
</ul>
<p>##参考<br><a href="http://fykyx521.iteye.com/blog/428352" target="_blank" rel="external">添加外键</a><br><a href="http://database.51cto.com/art/201010/229146.htm" target="_blank" rel="external">外键删除</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Sql-Constraints" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/08/24/Sql-Constraints/" class="article-date">
  	<time datetime="2014-08-24T13:17:00.000Z" itemprop="datePublished">2014-08-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/24/Sql-Constraints/">SQL约束</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>SQL Constraints ：</p>
<p>对于XXX约束进行添加删除，修改的操作模式一般如下：</p>
<p>添加约束：<br>CREATE TABLE xxxTable(<br>字段1 字段类型 约束类型(PRIMARY KEY等)<br>···<br>字段N 字段类型 ···<br>)</p>
<p>CREATE TABLE xxxTable(<br>字段1 字段类型 CONSTRAINT 约束名称 约束类型(目标约束字段1，目标约束字段2…目标约束字段N)<br>···<br>字段N 字段类型 ···<br>)</p>
<p>修改约束：<br>ALERT TABLE xxxTable<br>ADD 约束类型 （目标约束字段1，目标2…目标N）</p>
<p>ALERT TABLE xxxTable<br>ADD CONSTRAINT 约束名称 约束类型(目标约束字段1，目标2…目标N)</p>
<p>删除约束：</p>
<p>ALERT TABLE xxxTable<br>DROP 约束类型 约束名称          MySQL</p>
<p>ALERT TABLE xxxTable<br>DROP CONSTRAINT 约束名称    其他SQL的操作</p>
<ol>
<li><p>NOT NULL ：强制约束字段不能为NULL</p>
</li>
<li><p>UNIQUE：唯一标识一个元组，一个表中可以多个UNIQUE约束的字段<br>如果需要为多个列定义UNIQUE约束可以这样操作：</p>
</li>
</ol>
<p>CREATE TABLE Persons<br>(<br>Id_P int NOT NULL,<br>LastName varchar(255) NOT NULL,<br>FirstName varchar(255),<br>Address varchar(255),<br>City varchar(255),<br>CONSTRAINT uc_PersonID UNIQUE (Id_P,LastName)<br>)</p>
<p>如果一个表已经被创建，但是需要在某个字段上加上UNIQUE约束，操作如下：<br>ALERT TABLE tableName ADD UNIQUE (字段名称)</p>
<p>如果需要给添加的UNIQUE命名，并且为多个列加上UNIQUE约束，操作如下：<br>ALERT TABLE tableName ADD CONSTRAINT 约束名称 UNIQUE (字段1，字段2…字段N)<br>注意：约束名称的命名规则一般是，uq<em>字段名 或者 uq</em>组名</p>
<p>撤销UNIQUE：<br>MySql ：       ALERT TABLE tableName DROP INDEX 约束名<br>其他SQL：    ALERT TABLE tableName DROP CONSTRAINT 约束名 </p>
<ol>
<li>PRIMARY KEY: 一个表中的主键，会自动生成一个UNIQUE约束，一个表中只能有一个主键<br>PRIMARY KEY 主键约束，每一个表中只能主键，而且有且仅有一个主键，主键列的值不能为NULL。一个表中可以有多个字段一起组成一个主键，但是主键只能有一个。添加删除主键的方式类似于添加或删除UNIQUE约束。</li>
</ol>
<p>ALTER TABLE Persons<br>ADD CONSTRAINT pk_PersonID PRIMARY KEY (Id_P,LastName)</p>
<p>ALTER TABLE Persons<br>ADD  PRIMARY KEY (Id_P)</p>
<p>ALTER TABLE Persons<br>DROP CONSTRAINT pk_PersonID </p>
<p>ALTER TABLE Persons<br>DROP PRIMARY KEY</p>
<ol>
<li>FOREIGN KEY: 外键，一个表中的FOREIGN KEY指向另一个表中的PRIMARY KEY。</li>
</ol>
<p>FOREIGN KEY用于预防破坏表之间连接的操作，也可约束非法插入的数据。生成或删除FROGIN KEY的方法与生成其他约束的方法相同。</p>
<ol>
<li><p>CHECK：自检约束，如果某列或者某几列定义了该约束，那么在对该表进行操作的时候，这列或者这几列会检查操作是否符合他们各自的约束条件，如果符合约束条件那么允许操作，否则操作失败。</p>
</li>
<li><p>DEFAULT:该约束会向列中插入默认值，如果列没有其他的值，那么会将默认值加入到该列中。</p>
</li>
</ol>
<p>创建表时加入默认值：</p>
<p>CREATE TABLE Orders<br>(<br>     Id_O int NOT NULL,<br>     OrderNo int NOT NULL,<br>     Id_P int,<br>     OrderDate date DEFAULT GETDATE()<br>)</p>
<p>向以经存在的表加入默认值：</p>
<p>ALTER TABLE Persons<br>ALTER City SET DEFAULT ‘ShangHai’</p>
<p>删除默认值：</p>
<p>ALTER TABLE Persons<br>ALTER City DROP DEFAULT</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-async-task" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/08/17/async-task/" class="article-date">
  	<time datetime="2014-08-17T10:50:00.000Z" itemprop="datePublished">2014-08-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/17/async-task/">AsyncTask的执行过程</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##AsyncTask是什么？</p>
<p>AsyncTask是Android系统提供的用来执行异步任务的工具类，它提供了一系列可覆盖的方法，可以对任务执行的各个时期进行操作。</p>
<p>##AsyncTask是如何实现UI线程与非UI线程切换的？</p>
<p>AsyncTask内部封装了一个Handler，和一个ThreadPool，具体的任务交给ThreadPool中的线程来处理，并且使用Handler来通知UI线程将异步处理的结果更新到UI上去。</p>
<p>##AsyncTask的执行过程是怎样的？</p>
<ul>
<li>在执行一个AsyncTask之前我们需要创建一个AsyncTask的对象，创建AsyncTask对象asyncTask。</li>
<li>创建好对象之后我们调用AsyncTask对象的execute方法来启动AsyncTask这个异步任务。</li>
<li>这里需要注意的是AsyncTask必须在UI线程中启动。</li>
</ul>
<p>AsyncTask启动后它首先会在UI线程中调用<code>onPreExecute()</code>方法，来做一些启动异步任务前的准备工作，比如说显示Loading动画等。接下来会调用sDefaultExecutor会调用它自己的execute方法并把FutureTask对象传入。在sDefaultExecutor的execute()方法中，会先将FutureTask对象封装成一个Runnable对象加入到一个ArrayDeque<runnable>队列中等待调度（防止多线程并发一起的重复调用），接下来从ArrayDeque取出FutureTask然后交给其内部自定义的一个线程池（TPE）来处理这个Runnable任务。TPE拿到这个Runnable任务后，交给其WorkerThread然后异步的运行这个Runnable。其中sDefaultExecutor的实现代码如下：<br><img src="http://7xii1s.com1.z0.glb.clouddn.com/sDefaultExecutor.jpg" alt="sDefaultExecutor"></runnable></p>
<p>AsyncTask在new一个Task的时候，会创建一个FutureTask，在这个FutureTask中会传入一个实现了Callable接口的对象，在这个Callable对象的call()方法中才会真正调用doInBackground()这个方法，在doInBackground()方法执行结束后，会返回处理的结果Result（泛型），然后调用AsyncTask的私有方法postResult()来传递Result到UI线程中。该方法内部先将Result和AsyncTask对象包装成AsyncTaskResult对象，然后通过Handler将该对象传递到UI线程，然后在UI线程中调用onPostExecute(Result result)这个被重载的方法进行UI处理。</p>
<p>postResult()的方法如下：<br><img src="http://7xii1s.com1.z0.glb.clouddn.com/postResult.jpg" alt="postResult"></p>
<p>其中AsyncTaskResult的实现如下：<br><img src="http://7xii1s.com1.z0.glb.clouddn.com/asyncTaskResult.jpg" alt="asyncTaskResult"></p>
<p>其中封装了AsyncTask和Result对象，另外一个就是sHandler，它是在AsyncTask初始化的时候就直接生成的静态对象，sHandler的实现如下：<br><img src="http://7xii1s.com1.z0.glb.clouddn.com/sHandler.jpg" alt="sHandler"></p>
<p>在Handler中(UI线程中)调用mTask.finish()方法结束AsyncTask,该方法的实现如下：<br><img src="http://7xii1s.com1.z0.glb.clouddn.com/finish.jpg" alt="finish"></p>
<p>可以看出在该方法中调用了方法onPostExecute(Result result)，这样AsyncTask就执行结束了，这就是整个AsyncTask的整个执行过程！</p>
<p>注：在FutureTask在被创建时会重写父类的done()方法</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-http-cache" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/08/10/http-cache/" class="article-date">
  	<time datetime="2014-08-10T11:45:00.000Z" itemprop="datePublished">2014-08-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/10/http-cache/">Http Cache 简介</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##什么是HTTP CACHE?</p>
<p>Http Cache是一种客户端和服务器进行“高效交流”的机制。当我们使用浏览器去访问一个页面时，浏览器在显示该页面的时候也会将该页面缓存到本地，如果我们下次访问同一个页面，如果页面没有变化服务器就会返回304 Not Modified给浏览器，此时浏览器就不需要重新下载网页，直接显示本地缓存的网页即可。</p>
<p>##Http Cache的作用<br>上面判断是否有更新的过程用到的就是Http Cache。<br>当浏览器第一次访问网页A时，服务器会在Response的Header里面发送如下状态标示给浏览器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Etag               427fe7b6442f2096dff4f92339305444</span><br><span class="line">Last-Modified      Fri, 04 Sep 2009 05:55:43 GMT</span><br></pre></td></tr></table></figure>
<p>这就是告诉浏览器，A页面的最后修改时间和Etag浏览器会将A页面和这些状态标识一并缓存起来。当浏览器再次访问A页面时，在Request 的Header里面就会加上如下的状态标识：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">If-None-Match           427fe7b6442f2096dff4f92339305444</span><br><span class="line">If-Modified-Since       Fri, 04 Sep 2009 05:55:43 GMT</span><br></pre></td></tr></table></figure>
<p>这就是告诉服务器，我本地缓存的A页面最后修改时间和Etag，服务器拿到浏览器传来的最后修改时间和Etag之后，开始进行核对，检查在用户上次请求后是否有新的内容:</p>
<p>如果有新的内容，则重复第一次访问的情况，缓存网页和新的Etag与最后修改时间如果没有内容更新，则直接返回304 Not Modified。这是告诉浏览器，没有内容更新，不需要重新下载网页，使用本地缓存即可。使用HttpCache不仅可以提高Web Server的性能减少重复下载相同网页的带宽消耗，也可以的客户端响应速度更快，有更好的体验，并且减少客户端的流量消耗和电量消耗。</p>
<p>##Http Cache 如何使用：</p>
<p>要使用HttpCache，这个需要客户端和服务端都遵守这套“交流机制”，这样当客户端访问一个URL的时候，需要带上Http Cache指定的标示符，服务端需要解析这些特定的标识符，并且返回相对应的标识符给客户端，客户端需要缓存这些标识符。这样，服务端和客户端都遵从这一标准就可以实现Http Cache的功能，提高性能。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Android-event-dispatch" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/08/03/Android-event-dispatch/" class="article-date">
  	<time datetime="2014-08-03T13:51:00.000Z" itemprop="datePublished">2014-08-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/03/Android-event-dispatch/">Android 事件传递机制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>Android中所有的事件都是基于“按下（ActionDown）”这个动作之后的。</li>
<li>Android中所有的视图都继承自View，通过各种布局组件(ViewGroup)来对View进行布局。所有的“UI控件(Button，TextView等)”都是继承自View，所有的“布局控件(RelativeLayout等)”，“容器控件(ListView等)”都是继承自ViewGroup，ViewGroup是继承自View的。</li>
</ol>
<p>事件主要在ViewGroup和View之间进行传递，他们处理对事件的方法如下：</p>
<p>View：<br>          public boolean dispatchTouchEvent(MotionEvent event)<br>          public boolean onTouchEvent(MotionEvent event)<br>ViewGroup:<br>          public boolean dispatchTouchEvent(MotionEvent event)<br>          public boolean onTouchEvent(MotionEvent event)<br>          public boolean onInterceptTouchEvent(MotionEvent event)</p>
<p>这些方法中都会接收一个MotionEvent对象，该类继承自InputEvent，MotionEvent是用户的动作行为的封装类，我们可以通过MotionEvent对象内部的信息就可以获取用户的行为。</p>
<p>以上三个方法的作用：</p>
<ul>
<li><p>dispatchTouchEvent：用于分发事件，Android中所有的事件都是由这个方法进行分发的，返回true表示事件被消费，不继续分发，返回false则继续往下分发。如果事件分发给ViewGroup，则是交给onInterceptTouchEvent方法判断是否需要拦截该事件。</p>
</li>
<li><p>onTouchEvent：用来处理事假，返回true表示消费了事件，事件将不再向下传递。</p>
</li>
</ul>
<ul>
<li>onInterceptTouchEvent：它是ViewGroup中才有的方法，它的作用就是拦截事件，返回true表示事件被拦截，将不再向下传递。而是交给自身的onTouchEvent处理。该方法默认返回false，即不进行拦截。</li>
</ul>
<p>Touch事件的传递过程：<br>     先由Activity的dispatchTouchEvent分发给具体的UI组件(比如被点击的Button)，然后由TargetView的dispatchTouchEvent再进行分发，然后由自己的OnTouchEvent处理，在处理过程中，先调用注册在自己身上的onTouchListener对象中的onTouch方法。然后在执行OnTouchEvent方法，当OnTouchEvent执行完毕后，会调用View的onClick方法，该方法是在OnTouchEvent方法中处理ACTION_UP的这个分支中处理的performClick方法中调用的。<br>     因此onTouch会在onClick之前调用，onClick方法会在ACTION_UP的时候调用，而不是在ACTION_DOWN的时候调用。执行了onTouch方法的时候如果返回true时dispatchTouchEvent也会返回true，事件就不会再往下执行了，也就不会再去执行onTouchEvent方法了，也就不会再去执行onClick方法了。</p>
<p>事件传递的流程图：<br><img src="http://7xii1s.com1.z0.glb.clouddn.com/charflow.jpg" alt="event"></p>
<p>对于嵌套布局的事件传递是：</p>
<ol>
<li><p>Activity —&gt;  ViewGroup   —&gt;  View</p>
</li>
<li><p>onTouch事件是在dispatchTouchEvent中调用，onClick方法是在onTouchEvent中调用，onTouchEvent是在目标View的onTouchListener不存在或者返回了false的前提下才会被dispatchTouchEvent方法调用。</p>
</li>
<li><p>onInterceptTouchEvent方法的作用是拦截MotionEvent，它是ViewGroup特有的方法，如果在ViewGroup中它返回true表示事件被拦截，那么事件就不会再传递到View中去了。表现的现象就是你点击Layout中的一个Button但是调用的却是Layout中的onClick方法。</p>
</li>
</ol>
<p>常用控件之间的继承关系：<br><img src="http://7xii1s.com1.z0.glb.clouddn.com/over.jpg" alt="overried"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-BitmapFactory-Options-参数详解" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/07/20/BitmapFactory-Options-参数详解/" class="article-date">
  	<time datetime="2014-07-20T14:24:00.000Z" itemprop="datePublished">2014-07-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/20/BitmapFactory-Options-参数详解/">BitmapFactory.Options 参数详解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>常用参数： <code>inJustDecodeBounds</code> <code>inSampleSize</code> <code>inPurgeable</code> <code>inInputShareable</code> <code>inTempStorage</code> <code>outWith</code> <code>outHeight</code> <code>outMimeType</code></p>
<ol>
<li><p>inMutable true 返回一个可变（可被修改）的Bitmap对象，false 返回一个不可变的Bitmap对象（即不可修改的）</p>
</li>
<li><p>inJustDecodeBounds 为true时，只是获取图片的信息，并不对图片进行解析，所以可以通过Options获取图片的信息，false时返回解析后的Bitmap对象</p>
</li>
<li><p>inSampleSize 默认为1，小于1的值也当1处理。eg： 200 <em> 200 的图片，if inSampleSize == 1 then 200 </em> 200<br>if inSampleSize == 2 then 100 * 100； 整个图片的大小变为原来的1/4 (即1/2^2)</p>
</li>
<li><p>inInputShareable 和 inPurgeable 是在一起使用，如果inPurgeable为false，那么inInputShareable会被忽略，如果为true，那么当inInputShareable为true时，the bitmap can share a reference to the input data or make a deep copy</p>
</li>
<li><p>inPreferQualityOverSpeed 为true时，解析高质量的图片，不在乎解析快慢。</p>
</li>
<li><p>inPreferredConfig if non-null then 按照这个Config的配置来解析图片，else 按照系统配置来解析，默认按照ARGB_8888来解析。</p>
</li>
<li><p>inPremultiplied默认为true，if false then 关闭Alpha通道。不常用，只有在进行图片深度处理RenderScript或者OpenGL处理的时候才会用到。普通的canvas之类的不需要修改保持默认就好，修改会报错。</p>
</li>
<li><p>inPurgeable if true then 当Bitmap被回收后，如果又需要这个Bitmap时，会自动re-decode。因此inPurgeable 可以帮助系统节省内存，但是在快速滑动（ListView等）中不要使用，这样会增加GC负担，性能下降。如果是在fluid 和fast fly UI中建议使用inBitmap来减少内存消耗。这个属性在使用decodeResource和decodeFile的时候被忽略。</p>
</li>
<li><p>inScaled if true then 按照inTargetDensity来对图片进行拉伸缩放，而不是按照系统条件缩放，默认是true，点9图会忽略这个选项，永远都会被拉伸。</p>
</li>
<li><p>inTempStorage 是byte[]数组，建议大小为16K。类似于view.setTag(Object).</p>
</li>
<li><p>outWidth,outHeight,outMimeType在获取图片信息时，会被赋值。分别代表图片的宽、高、类型</p>
</li>
<li><p>mCancel decode过程是否可以被中断。</p>
</li>
<li><p>inDither true 让图片抖动。</p>
</li>
<li><p>inDensity inScaled inTargetDensity inScreenDensity 一起使用，用来设置图片是否需要拉伸，和要拉伸的像素密度。（系统默认的density为160）</p>
</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Code-Style" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/07/12/Code-Style/" class="article-date">
  	<time datetime="2014-07-12T15:44:00.000Z" itemprop="datePublished">2014-07-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/12/Code-Style/">编码规范总结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##Android 编码规范</p>
<ol>
<li>不许留下空的Catch语句，对Catch一定要处理。如果不处理请注明原因，或者向方法的调用者跑出异常。</li>
<li>不要去捕获顶级异常，使用多个catch去捕获不同的小异常。</li>
<li>不要使用finalizers，因为它的执行时机是不确定的。</li>
<li>如果代码超过了40行就应该考虑在不损坏程序代码结构的情况下进行拆分！</li>
<li>尽可能的使用局部变量，变量的影响范围越小越好。</li>
<li>应该在第一次使用局部变量的地方进行声明，几乎所有的局部变量都应该进行初始化，如果缺少做够的信息来正确的初始化，应该推迟变量的声明，等到有足够的信息之后再进行初始化！</li>
<li>循环变量都应该在for语句内进行声明。</li>
<li>使用8个空格来对换行后的代码进行缩进。</li>
<li>非public和非static字段命名时以m开头，static字段命名以s开头，其他字段以小写字母开头。</li>
<li>public static final 常量字段全部字母大写，并用下划线进行分隔。</li>
<li>大括号不能单独占用一行。</li>
<li>if之后必须加上大括号，避免省略大括号的情况出现。（自己）</li>
<li>if的嵌套结构不能超过两层(自己)</li>
<li>每行不能超过100个字符。</li>
<li>如果使用了<code>@Deprecated</code>来注解一个方法，那么必须使用<code>@deprecated Javadoc</code>标记来指明替代方法。</li>
<li><code>@SupperWarning</code>用于无法消除的编译警告，但是此处经过严格确认是无误的，才可用<code>@SuperWarning</code>。当需要使用<code>@SuperWarning</code>的时候必须加上<code>TODO</code>用于解释不能消除的<code>Warning</code>的原因</li>
<li>简称等同于单词，因此应该将简称当做正常的单词来处理。<code>eg：XmlHttpRequest优于XMLHTTPRequest</code></li>
<li>约定：在一个模块编写测试完成后删除掉所有的Log。</li>
<li>遵守Java Test命名规范：<code>test方法名_测试条件testIsDistinguishable_protanopia();</code></li>
</ol>
<p>##面向对象开发原则 SOLID</p>
<ol>
<li>单一职责：方法功能必须单一，条条大路通罗马，只能罗马！</li>
<li>开闭原则：对扩展开放，对修改封闭。</li>
<li>里氏替换原则：所有的父类都应该能被子类替换，并且不改变当前代码的行为</li>
<li>依赖导致原则：所有的类都应该依赖接口，不应该依赖具体的实现。</li>
<li>接口隔离原则：根据客户端的需要来创建接口，而不是客户端的实现，禁止出现让客户端实现他们不需要的接口。</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Loading-large-bitmap" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/07/06/Loading-large-bitmap/" class="article-date">
  	<time datetime="2014-07-06T03:00:00.000Z" itemprop="datePublished">2014-07-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/06/Loading-large-bitmap/">Loading Large Bitmap</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在我们加载图片的时候，经常会出现这种情况，我们加载的图片的解析度已经远远超出我们设备的解析度，而且太<br>大的图片会占据比较大的内存带来大的内存开销，如果对这些内存回收管理不及时，很容易造成OutOfMemory运<br>行时异常，导致整个应用崩溃，因此为了避免这种情况的发生，我们在decode图片的时候应当根据自己设备的解<br>析度来解析，只需要解析出适合我们当前设备的图片即可，不需要解析出超高分辨率的图片，因为超高分辨率的图<br>片对我们的视觉体验带来不了任何帮助，反而会占用宝贵的内存，产生性能问题。下面我们将讨论如何将一张大图<br>片解析成一个符合当前设备内存要求的小图片。</p>
<p>##Read Bitmap Dimensions and Type<br><code>BitmapFactory</code>类提供了许多解析图片的方法(<code>decodeByteArray()</code> <code>decodeFile()</code><br><code>decodeResource()</code> <code>decodeStream()</code>等)来解析各种形式的图片。这些方法在执行的时候都会为图片<br>分配一块内存去解析图片，这样做很容易导致OOM的发生。但是系统为每个图片解析的方法都提供了一个<br><code>BitmapFactory.Option</code>对象做为参数，来设置我们的解析过程是否分配内存给被解析的图片。<br>设置<code>Options.inJustDecodeBounds = true</code>，则在解析的时候不会为Bitmap分配内存，因此解析完成<br>后返回的Bitmap对象将会是null。<br>因此如果我们想知道这个图片的尺寸和类型，我们可以先设置<code>Options.inJustDecodeBounds = true</code>，<br>然后调用decode方法并且传入Options对象，然后在decode结束后，我们可以通过<code>Options.outWidth</code>、<br><code>Optinons.outHeight</code>和<code>Options.outMimeType</code>,获得图片的尺寸以及图片的类型。<br>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BitmapFactory.Options opt = new BitmapFactory.Options();</span><br><span class="line">opt.inJustDecodeBounds = true; //解析时不分配内存，仅仅是获取图片信息</span><br><span class="line">BitmapFactory.decodeResource(getResource(),R.id.image,opt);</span><br><span class="line">int imageWidth = opt.outWidth;</span><br><span class="line">int imageHeight = opt.outHeight;</span><br><span class="line">String imageType = opt.outMimeType;</span><br></pre></td></tr></table></figure>
<p>这样我们就得到了图片的尺寸和类型。<br>为例避免OOM发生我们在解析前，我们需要在解析前检查图片的尺寸和大小，是否符合我们的需求。</p>
<p>##Load a Scaled Down Version into Memory<br>既然我们已经知道了图片的尺寸，下来我么就需要考虑是加载这个图片呢还是加载一个低解析度的版本。我们可以<br>通过如下几个因素来考虑</p>
<ul>
<li>估算加载整个图片所需要的内存大小</li>
<li>是否有足够多的内存来装载图片</li>
<li>装载图片的目标Image UI的尺寸（如果是小尺寸，那么只需要低解析度的图片即可）</li>
<li>当前设备的屏幕尺寸和像素密度</li>
</ul>
<p>例如，我们不需要将一个1024 <em> 768 px的图片加载到一个126 </em> 96 的ImageView中去。</p>
<p>为了告诉解析器，我们只需要加载一个合适的解析度的图片，可以通过设置<br><code>BitmapFactory.Options.inSampleSize = 数字</code>即可。<br>例如解析一个<strong><code>2048 * 1536</code> 的图片(12M)，使用的<code>inSampleSize = 4</code>，<br>解析出来的图片的为 <code>512*384</code>(0.75M)大小变为原来的<code>inSampleSize^2</code>分之1</strong>。<br><em>即： 0.75 M= 12M/(4 </em> 4)*</p>
<blockquote>
<p>注意:这里假定使用的图片是ARGB_8888编码的32位图片</p>
</blockquote>
<p>下面是一个计算<code>inSampleSize</code>取值的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public static int calculateInSampleSize(</span><br><span class="line">	BitmapFactory.Options opt, int reqWidth,</span><br><span class="line">	 int reqHeight)&#123;</span><br><span class="line">	final int height = opt.outHeight;</span><br><span class="line">	final int width = opt.outWidth;</span><br><span class="line">	int inSampleSize = 1;</span><br><span class="line">	if(height &gt; reqHeight || width &gt; reqWidth)&#123;</span><br><span class="line">		final int halfHeight = height/2;</span><br><span class="line">		final int halfWidth = width/2;</span><br><span class="line">		while(halfHeight/inSampleSize &gt; reqHeight &amp;&amp;</span><br><span class="line">			halfWidth/inSampleSize &gt; reqWidth)&#123;</span><br><span class="line">			inSampleSize *= 2;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return inSampleSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在使用上述方法之前，必须先获取图片的尺寸信息。</p>
<p>有了上面介绍的方法，以后在加载图片我们可以按照下面步骤进行：</p>
<ol>
<li>获取图片的尺寸和类型</li>
<li>根据所需要的图片大小，获取最佳的<code>inSampleSize</code>值</li>
<li>使用2中获得的<code>inSampleSize</code>来解析图片</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static Bitmap decodeSampledBmpFromResource(</span><br><span class="line">	Resource res,int resId,int reqHeight,int reqWidth)&#123;</span><br><span class="line">	// 1.获取图片的尺寸信息</span><br><span class="line">	BitmapFactory.Options opt = new BitmapFactory.Options();</span><br><span class="line">	opt.inJustDecodeBounds = true;</span><br><span class="line">	BitmapFactory.decodeFromResource(res,resId,opt);</span><br><span class="line">	// 2.计算最佳inSampleSize值</span><br><span class="line">	opt.inSampleSize=</span><br><span class="line">	calculateInSampleSize(opt,reqWidth,reqHeight);</span><br><span class="line">	// 3.将原图解析成需要的Bitmap</span><br><span class="line">	opt.inJustDecodeBounds = false;//否则解析出的bmp为null</span><br><span class="line">	return BitmapFactory.decodeFromResource(res,resId,opt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-google-io-14" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/28/google-io-14/" class="article-date">
  	<time datetime="2014-06-27T16:13:00.000Z" itemprop="datePublished">2014-06-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/28/google-io-14/">Google IO 2014 汇总（瞎扯）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##Design</p>
<p>###Material design<br>Material design是本届IO上发布的一种新的设计规范，使用了Google全新的动画以及UI库，将会应用到Google的全线产品。<br><a href="http://developer.android.com/preview/material/index.html" target="_blank" rel="external">Material Design</a></p>
<blockquote>
<p>Material Design统一了Google的全线产品，使得所有产品在任何平台之间无缝切换，对用户体验有非常大的提升，无论何时何地我们的使用的服务都是不间断的，这一定会很爽。</p>
</blockquote>
<p>###Android L<br>完全采用Material Design 设计的<a href="http://googledevelopers.blogspot.com/2014/06/this-is-material-design.html" target="_blank" rel="external">Android</a>系统。</p>
<p>##Developer</p>
<p>###Android TV<br><a href="https://developer.android.com/tv/index.html" target="_blank" rel="external">Android TV</a>是Google Home计划重要的一步。对于我们国内来说，它和其他的盒子没有什么不同，许多它提供的服务对我们来说就是摆设，因为用不了~~</p>
<blockquote>
<p>但是由于Google此次推出的这个平台对于TV平台的盒子类产品做了一个标杆的作用，而且会使得在TV平台上的App开发更容易，而且也提供了官方的指导和规范，可能很快会有大批的服务移植到TV平台，如果可以，我们也可以推出一个<code>健康助手类</code>的TV 平台的App，在用户看电视或者进行游戏视频娱乐项目时，可提醒用户健康生活，或者提供一些健康服务。以后也可以接入健康医疗服务等等，方便在家的老人，Android进入客厅，而且有Google支持相信会有更多的标准或者规范出来，为家庭服务提供更多机会。</p>
</blockquote>
<p>###Android Wear<br><a href="https://developer.android.com/wear/index.html" target="_blank" rel="external">Android Wear</a>是Google的可穿戴设备平台，完全打通了其与手机的交互与信息交流。</p>
<blockquote>
<p>也许在不久的将来，我们根本不需要手机之类的笨重的东西，眼睛手表完全可以完成所有手机的功能，随着语音技术的成熟，或许以后只要有手表和蓝牙耳机打电话只用语音输入，所有操作都是声控完成。目前，Android Wear 在G Watch等上只是处理提醒等简单频繁的任务，主要交互方式是语音和手势操作来完成。</p>
</blockquote>
<p>###Google Fit<br><a href="https://developers.google.com/fit" target="_blank" rel="external">Google Fit</a>是Google推出的一向个人健康服务平台，第三方应用（软件/硬件）可以通过Google fit提供的接口将健康数据保存到你的个人系统中，与Apple的Health kit 类似。</p>
<blockquote>
<p>我认为这个项目于Google TV 等Google @ Home计划将会深度结合，利用TV平台和Wear平台提供数据，建立一个完整的个人生长信息。为人类的整个生命周期积累数据，对预防重大疾病提供数据基础，并且对已经患病的群体提供更多的健康关怀和诊疗服务，尤其是对那些行动不便，或者有突发性疾病的用户来说更加重要，Google Fit未来的用户将以80后90后为先导，随后各类人群均会使用。</p>
</blockquote>
<h3 id="Android-Auto"><a href="#Android-Auto" class="headerlink" title="Android Auto"></a>Android Auto</h3><p><a href="https://developer.android.com/auto/index.html" target="_blank" rel="external">Android Auto</a>是Google推出的一个具有车联网概念的互联平台（我更喜欢成为生活工具交通工具互联平台）。</p>
<blockquote>
<p>目前虽然只是应用于汽车，不排除以后运行到各个交通工具的可能。一定会用到各个交通工具上。假如你要从A地到B地，期间要使用多种交通工具（自行车，轮船，汽车，地铁），你设定好起点和终点，骑上自行车，自行车会发出信号告诉汽车你会走那条路，根据你当前Google Fit 提供的身体健康数据，根据你的身体状况预计你什么时候会到那个地方，汽车收到通知后准时等待着你的到来，当你乘上汽车后，car会根据其他car的目的和路线安排一条能安你预定时间到达的线路，避开大家都走的线路，将你顺利的送到目的地。</p>
</blockquote>
<p><em>此次Google IO发布了很多平台和服务，但是目前来看，都是一个控制中那就是你的手机，随时随地可以以最低成本接入到互联网中来控制和操作你所有的服务以及工具。我认为Google目前的热气球项目和前不久刚收购的卫星公司，都是在为Any one Any time Any where online，做基础。Android与Chrome深度整合，Google平台所有应用统一风格，native app 和 web app区别越来越小，我认为Google是在有意让我们不去离线，你所有的信息服务都可以存储在云端，你的思想灵魂（大数据机器学习来实现）都可以永存。即使有一天急不在了，可以在一个新的躯体内登陆你的账号，瞬间你的所有的思想精神都会同步到这个新的宿主里。就像我们换了一台全新的电脑，当你装上Chrome登陆你的账号，你熟悉的一切就都回来了。</em></p>
<p>总之，此次发布会上的各个平台，有很大的想象空间！<br>Google 你伟大的不是一点点！</p>
<p>瞎扯完毕，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-OOM" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/22/OOM/" class="article-date">
  	<time datetime="2014-06-21T16:30:00.000Z" itemprop="datePublished">2014-06-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/22/OOM/">OOM 的解决方法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###OOM产生的原因</p>
<ul>
<li>Android原生系统规定对一个Application的内存限制为16M。(高分辨率的手机内存限制会高于16M,但是我们在编写程序的时候应当以最低标准为准，这样我们的应用就会更加健壮)</li>
</ul>
<p>对于这一点我们最好可以按照屏幕的分辨率来加载不同解析度的图片解析度的图片，因为在低分辨率的屏幕上加载高解析度的图片只是白白浪费内存再不会有任何别的好处，因为低分辨率的屏幕显示高解析度的图片和显示低解析度的图片没什么区别。</p>
<p>###OOM的解决方法</p>
<p>####从图片资源本身入手<br>对于图片选择这个问题，在不到万不得已的情况下，可以用低解析度的图片就用低解析度的图片。图片的解析度低占用的内存就少，出现OOM的可能就小。</p>
<p>####从程序本身入手</p>
<ul>
<li>在加载图片时，使用BitmapFactory.decodeFromStream()方法，因为该方法会通过直接调用JNI&gt;&gt;nativeDecodeAsset()來完成decode，无需再使用Java层的createBitmap()，这样就节省了Java层的内存空间。<br>代码如下：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Bitmap <span class="title">getLocalBitmap</span><span class="params">(Context context,<span class="keyword">int</span> resourceId)</span></span>&#123;</span><br><span class="line">    InputStream inputStream = context.getResource()</span><br><span class="line">    .openRawResource(resourceId);</span><br><span class="line">    <span class="keyword">return</span> BitmapFactory.decodeStream(inputStream,<span class="keyword">null</span></span><br><span class="line">    ,getBitmapOptions());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>設定 BitmapFactory.Options inSampleSize,(inSampleSize值越大解析度越小,占用的memory也越小)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** int scale 为图片的缩放度*/</span></span><br><span class="line"><span class="keyword">public</span> BitmapFactory.<span class="function">Options <span class="title">getBitmapOptions</span><span class="params">(<span class="keyword">int</span> scale)</span></span>&#123;</span><br><span class="line">    BitmapFactory.Options options = <span class="keyword">new</span> BitmapFactory.Options();</span><br><span class="line">    <span class="comment">//设置为true，如果系统内存不足，可回收图片内存</span></span><br><span class="line">    options.inPurgeable = <span class="keyword">true</span>; </span><br><span class="line">    options.inInputShareable = <span class="keyword">true</span>;<span class="comment">//和inPurgeable属性一起使用</span></span><br><span class="line">    options.inSampleSize = scale;<span class="comment">//解析度，值越大返回的图片尺寸越小(2~4)</span></span><br><span class="line">    <span class="keyword">return</span> options;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在onPause(),onStop(),onDestory()的时候将不用的Bitmap release掉。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bitmap.recycle(); </span><br><span class="line">System.gc();</span><br></pre></td></tr></table></figure>
<ul>
<li>另外在BitmapFactory.Options里有一个隐藏的public参数<code>inNativeAlloc</code>，将这个参数设置为true，这样会将OOM的可能性更进一步降低。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BitmapFactory.Options.class.getFiled(<span class="string">"inAlloc"</span>)</span><br><span class="line">.setBoolean(options,<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>我们也可以通<code>dlvik.system.VMRuntime</code>来修改系统分配给应用的内存大小</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CUS_MAX_VM_HEAP = <span class="number">32</span>*<span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line">VMRuntime.getRuntime()</span><br><span class="line">.setMinmumHeapSize(CUS_MAX_VM_HEAP);</span><br></pre></td></tr></table></figure>
<ul>
<li>一般情况下不推荐使用<code>createBitmap</code>来创建图片，但是如果必须要用可以进行如下优化：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//透明度占8位</span></span><br><span class="line">Bitmap.createBitmap(width,height,Bitmap.Config_ALPHA_8);</span><br><span class="line"><span class="comment">//每个Pixel占4个像素</span></span><br><span class="line">Bitmap.createBitmap(width,height,Bitmap.Config_ARGB_4444);</span><br><span class="line"><span class="comment">//每个Pixel占8个像素（常用Config）</span></span><br><span class="line">Bitmap.createBitmap(width,height,Bitmap.Config_ARGB_8888);</span><br><span class="line"><span class="comment">//没有透明度，R占5位，B占6位，G占5位</span></span><br><span class="line">Bitmap.createBitmap(width.height,Bitmap.Config_RGB_565);</span><br></pre></td></tr></table></figure>
<ul>
<li>在调用<code>setBackgroundResource(int resourceId)</code>时，系统会为了性能问题，将id对应的图片缓存起来。当我们在onDestory中将background中的Bitmap recycle掉时，如果我们此时back到这个Activity中的时候，系统会报<code>use a recycled bitmap execption</code>，因为系统会调用缓存的Bitmap，但是这个Bitmap已经被我们释放掉了。为了避免这个问题的发生我们可以不使用系统缓存：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">InputStream inputStream = context.getResource()</span><br><span class="line">.openRawResource(id);</span><br><span class="line">Bitmap bitmap = BitmapFactory.decodeStreame();</span><br><span class="line">mButton.setBackground(</span><br><span class="line"><span class="keyword">new</span> BitmapDrawable(getResource(),bitmap));</span><br><span class="line"><span class="comment">//代替mButton.setBackgroundResoure(id);</span></span><br></pre></td></tr></table></figure>
<p>在销毁图片的时候如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BitmapDrawable bd = (BitmapDrawable)mButton</span><br><span class="line">	.getBackground();</span><br><span class="line">bd.getBitmap.recycle();</span><br><span class="line">bd = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>
<p>按照以上方式我们可以根据不同的需求来创建Bitmap来防止OOM的发生。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Tough-regime-cranks-out-test-winners" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/06/Tough-regime-cranks-out-test-winners/" class="article-date">
  	<time datetime="2014-06-05T16:00:00.000Z" itemprop="datePublished">2014-06-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/06/Tough-regime-cranks-out-test-winners/">Tough regime cranks out test winners</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://7xii1s.com1.z0.glb.clouddn.com/201406061227.jpg" alt="School"></p>
<p><em>Students prepare for the gaokao, China’s national university entrance exam, at No 2 Middle School in Nanchang, the capital of Jiangxi province. ZHOU MI / XINHUA</em></p>
<blockquote>
<p>####<strong>大意：又是一年一度高考，每个经历过高考过的人，无论最后结果是好是好，都或多或少的会以自己的方式祭奠那曾经或喜或悲逝去的岁月，那时的我们思想简单，为了高考全力以赴，貌似只要考上大学，以后便是康庄大道，那时候的日子枯燥甚至让人窒息，但是我们简单坚定。对于高考制度，我不予置评，虽然简单粗暴，但是却是目前最公平的选拔人才的方式。今晚让我们一起祈祷，祈祷每个怀揣梦想的孩子静心入睡，放飞梦想。</strong></p>
<p>It’s <code>make-or-break</code> time for millions of high school students in China.</p>
</blockquote>
<pre><code>make-or-break:
英 [meik ɔ: breik] 美 [mek ɔr brek] 
conj. 不成则败 孤注一掷的
</code></pre><blockquote>
<p>Saturday morning signals the start of two days of <code>grueling</code> activity, both mental and physical, as students take the national university entrance exam known as gaokao. Because success in the exam can open the door to a <code>well-paid job</code> and <code>high social standing</code>, the pressure on the students can be overwhelming.</p>
</blockquote>
<pre><code>Grueling:
英 [&apos;grʊəlɪŋ] 美 [ˈɡruəlɪŋ, ˈɡrulɪŋ] 
adj. 紧张的，激烈的，使极度疲劳的 
adv. 紧张地，激烈地

well-paid job :一份不错的工作

high social standing:高社会地位的

overwhelming:
英 [ˌəʊvəˈwelmɪŋ] 美 [ˌovɚˈhwɛlmɪŋ, -ˈwɛl-] 
adj. 势不可挡的，压倒一切的，巨大的；
压倒一切的欢乐
</code></pre><blockquote>
<p>However, few students are as committed, or prepared for gaokao success, as those at Hengshui High School in Hebei province, which has <code>gained</code> <code>fame</code> - and some criticism - for its <code>tough</code> <code>regime</code> and <code>impressive</code> success rate.</p>
</blockquote>
<pre><code>Gained:
英 [geɪnd] 美 [geɪnd] 
v. 获得( gain的过去式和过去分词 )；
赢得；增加；（钟、表）走快

fame:
英 [feɪm] 美 [fem] 
n. 名声；名望；传闻；
传说 vt. 使闻名；
使出名；使有名望 

tough:
英 [tʌf] 美 [tʌf] 
adj. 坚强的，坚韧的，不屈不挠的；
艰苦的，困难的，难办的；
牢固的，强壮的；粗暴的
n. 粗暴的人；暴徒，恶棍 
vt. &lt;口&gt;忍耐，忍受（常与out连用） 
adv. 强硬地，顽强地；
以强硬的态度

regime
英 [reɪˈʒi:m] 美 [reˈʒim, rɪ-] 
n. 政治制度，政权，政体；
管理，方法；
[医]养生法；（病人等的）生活规则

impressive
英 [ɪmˈpresɪv] 美 [ɪmˈprɛsɪv] 
adj. 给人印象深刻的，感人的；
引人注目的；可观的；显赫
</code></pre><blockquote>
<p>For senior students, the day begins at 5:30 am and lasts until 10:10 pm, with every hour <code>punctuated</code> by the <code>incessant</code> ringing of bells that announce classes, break times, self-study periods, <code>extracurricular</code> activities and <code>dormitory</code> time.</p>
</blockquote>
<pre><code>Punctuated
[ˈpʌŋktʃu:ˌeɪtid] 
v. （在文字中）加标点符号，
加标点( punctuate的过去式和过去分词 )；
不时打断某事物

incessant
英 [ɪnˈsesnt] 美 [ɪnˈsɛsənt] 
adj. 不停的，持续不断的；
无尽无休

extracurricular
英 [ˌekstrəkə&apos;rɪkjʊlə] 美 [ˌekstrəkə&apos;rɪkjələ] 
adj. 学校课程以外的；课外

dormitory
[&apos;dɔ:mətrɪ] 美 [ˈdɔrmɪˌtɔri, -ˌtori] 
n. （学校等的）宿舍 集体寝室
（在市内工作的人的）郊外住宅区 
adj. 住宅区的
</code></pre><blockquote>
<p>The students spend most of their time in <code>cramped</code> classrooms. Although the designated food breaks last 40 minutes, many students rush to the <code>canteen</code> and <code>wolf down</code> their food in less than five minutes so they can <code>snatch</code> an extra few minutes for their studies.</p>
</blockquote>
<pre><code>Cramped
英 [kræmpt] 美 [kræmpt] 
adj. 狭窄的；难懂的
 v. 夹紧(cramp的过去式)；
 用夹钳夹；约束

canteen
英 [kænˈti:n] 美 [kænˈtin] 
n. 小卖部；食堂，小饭馆；
水罐；餐具盒，炊具箱

wolf down
英 [wulf daun] 美 [wʊlf daʊn] 
v. 狼吞虎咽地吃

snatch
英 [snætʃ] 美 [snætʃ] 
n. 抢；一阵子，一下工夫；
很小的数量；&lt;美俚&gt;诱拐
 vi. 作出握住或抢夺的动作；
 很快接受 
vt. 抢夺，夺得；
及时救助；[体育运动]举重
</code></pre><blockquote>
<p>Sun Yajian, a freshman at Shanghai International Studies University, who graduated from Hengshui High last year, said he even ran to the canteen to save time. “I usually spent three to five minutes eating dinner. Once, I even finished my meal in less than two minutes,” the 20-year-old said. “I only ate to fill my stomach. I didn’t care what I ate, just as long as I was full.”The <code>regime</code> is tough. In addition to teachers and members of the students union who <code>patrol</code> the school to ensure discipline, cameras constantly <code>scan</code> the classrooms searching for students neglecting their work. Cell phones are not allowed, and if you don’t consider the 20 minutes <code>allocated</code> daily for watching news broadcasts, or the weekly class meetings, which occasionally feature an <code>inspirational</code> video, as <code>entertainment</code>, then there’s no entertainment, either.</p>
</blockquote>
<pre><code>Patrol
英 [pə&apos;trəʊl] 美 [pəˈtrol] 
n. 巡逻，巡查；
巡逻队，侦察队；
童子军小队
 vt.&amp; vi. 巡逻，巡查

scan
英 [skæn] 美 [skæn] 
vt. &lt;计&gt;扫描；
细看；细查；
（雷达）对…进行扫描 
n. 扫描；浏览
；审视；
（雷达/屏面上的）光点 
vi. （光束、雷达等）扫描；
扫略；（诗歌）符合韵律；
标出诗歌的格律

allocated
英 [&apos;æləkeɪtɪd] 美 [&apos;æləkeɪtɪd] 
v. 分配，分派( allocate的过去式和过去分词 )；
把…拨给

inspirational
英 [ˌɪnspə&apos;reɪʃənl] 美 [ˌɪnspə&apos;reɪʃənl] 
adj. 给予灵感的，带有灵感的；
鼓舞人心的

entertainment
英 [ˌentəˈteɪnmənt] 美 [ˌɛntɚˈtenmənt] 
n. 娱乐，消遣；
招待，款待
；娱乐节目
</code></pre><blockquote>
<p>The students are usually given one day off every four weeks, after taking a monthly test, but they are also tested every day and once a week. The results are posted publicly to show the changes in each student’s ranking.The school is also famed for its tight management of extracurricular activity. Ren Yueming, a freshman at China University of Political Science and Law in Beijing, graduated from Hengshui High last year. She said students are not even allowed to see their parents privately at the school gates, and with the exception of formal holidays, they have to present the <code>doorkeeper</code> with a permit from their teacher if they want to leave the <code>campus</code>.</p>
</blockquote>
<pre><code>Doorkeeper
英 [ˈdɔ:ki:pə(r)] 美 [ˈdɔrˌkipɚ, ˈdor-] 
n. 看门人

campus
英 [&apos;kæmpəs] 美 [ˈkæmpəs] 
n. （大学）校园；
学校范围内；
大学或其分校；
大学生活
</code></pre><blockquote>
<p>In class, any activity unrelated to study can be considered a <code>breach</code> of discipline, including <code>shuffling papers</code> and chatting, said Sun. “Students have to follow the teachers in class. You can’t do things based on your own plans,” he said.</p>
</blockquote>
<pre><code>Breach
英 [bri:tʃ] 美 [britʃ] 
n. 破坏；破裂；缺口；
违背 vt. 攻破；
破坏，违反

shuffling papers：打牌
</code></pre><blockquote>
<p>The demanding system seems to pay <code>dividends</code>, though: In 2013, the school sent 104 graduates to Tsinghua University and Peking University, China’s <code>most-prestigious</code> universities. The figure accounted for 80 percent of the two universities’ total enrollment from Hebei, and 20% of the university candidates from Hebei who scored more than 600 points in the gaokao were graduates of Hengshui High.</p>
</blockquote>
<pre><code>Dividends
英 [&apos;dɪvɪdendz] 美 [&apos;dɪvɪdendz] 
n. 红利( dividend的名词复数 )；
股息；被除数；
（足球彩票的）彩金

most-prestigious：最负盛名的
</code></pre><blockquote>
<p>Last year was no <code>flash in the pan</code>, either. The school has been ranked Hebei’s number one for university enrollment for 14 <code>consecutive</code> years.However, while no one doubts the school’s success, critics argue that the routine <code>stifles</code> creativity and independent thought, and some have even labeled it an “academic factory”, focused purely on gaokao success to the <code>exclusion</code> of other aspects of the students’ <code>personalities</code>.</p>
</blockquote>
<pre><code> flash in the pan：昙花一现

consecutive
英 [kənˈsekjətɪv] 美 [kənˈsɛkjətɪv] 
adj. 连续的，连贯的；
[语]表示结果的

stifles
[ˈstaiflz] 
v. （使）窒息， 
（使）窒闷( stifle的第三人称单数 )；
镇压，遏制 

exclusion
英 [ɪkˈsklu:ʒn] 美 [ɪkˈskluʒən] 
n. 拒绝，杜绝；
排除，驱逐；
被排斥在外的人（或事物）；
排外主义

personalities
英 [ˌpɜ:sə&apos;nælɪtɪz] 美 [ˌpɜ:sə&apos;nælɪtɪz] 
n. （对某人容貌、性格等所进行的）人身攻击；
人身攻击( personality的名词复数 )；
人格；名人；特色
</code></pre><blockquote>
<p>“If I were offered the chance to choose again, I wouldn’t spend the three years at such a school, and I would never let my children attend such an institution,” said Li Jingnan, a graduate student majoring in <code>accountancy</code> at Tianjin University of Finance &amp; Economics.</p>
</blockquote>
<pre><code>Accountancy
英 [əˈkaʊntənsi] 美 [əˈkaʊntənsi] 
n. 会计工作，会计职业；
会计学
</code></pre><blockquote>
<p>Li said the academic day was even longer when he studied at Hengshui High 10 years ago. The 28-year-old said he was unhappy with the mode of teaching employed, claiming that it “tightly controls students”, making them mentally “<code>rigid</code>“, something that left him unprepared for life in the outside world. “I found myself <code>at a loss</code> when I entered university, not knowing what I wanted or what to do. I had lost my sense of direction after three years at the school where everything was <code>rigorously</code> controlled,” he said. </p>
</blockquote>
<pre><code>Rigid:
英 [ˈrɪdʒɪd] 美 [ˈrɪdʒɪd] 
adj. 严格的；僵硬的；
（规则、方法等）死板的；刚硬的，顽固的

at a loss:
英 [æt ə lɔs] 美 [æt e lɔs] 
不知所措
亏本；困惑；
神思恍惚

Rigorously:
英 [&apos;rɪɡərəslɪ] 美 [ˈrɪɡərəslɪ] 
adv. 严厉地，残酷地；
严密地
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 TedYin
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>